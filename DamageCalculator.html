<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>DamageCalculator</title>
 <style>
        body {
            background : #555
        }
        .content {
            width: 1240px;
            height : auto ;
            margin: auto;
            background: white;
            padding: 10px;
            font-size :18px;
            line-height :200%;
            float:none;
            overflow:auto;
			background-color:#F5F4F3;
         }
        .leftbox {
            width:608px;
            float:left;
            padding: 4px;
			position:relative;
        }
        .rightbox {
            width:608px;
            float:left;
            padding: 4px;
        }
        .BATK{
            width:110px;
            float:left;
        }
		.BATK_input{
			width:100px;
		}
		.cal_batk{
			clear:left;
			padding-top:10px;			
		}
		.cal_I{
			padding-top:6px;
			padding-bottom:6px;
			padding-left:6px;
			border:solid 1px #D5DFE5;
			border-radius:5px;
			overflow:auto;
			line-height:100%;
			margin-bottom:6px;
			box-shadow:inset 0 0 1px #FFF;	
		}
		.cal_I_cover{
			background-color:#f5f5f5;
			position:absolute;
			z-index:2;
			filter:alpha(opacity=70); 
			opacity:0.7;
			display: none;
			width:50%;
		}
		.small_label{
			font-size:14px;
		}
		.mini_label{
			font-size:12px;
			vertical-align:top;
		}
		.cal_I_formation_direction_div{
			width:95px;
			float:left;
			margin-left:12px;
			
		}
		.cal_I_formation_direction_input{
			width:80px;
			text-align:center;
			
		}
		.other_I{
			padding-top:6px;
			padding-bottom:6px;
			padding-left:6px;
			border:solid 1px #D5DFE5;
			border-radius:5px;
			overflow:auto;
			margin-bottom:6px;
			box-shadow:inset 0 0 1px #FFF;	
		}
		.button {
   			background-color: #4CAF50; /* Green */
    		border: 1px solid green;
    		color: white;
    		padding: 10px 22px;
    		text-align: center;
    		text-decoration: none;
    		display: inline-block;
    		font-size: 16px;
    		cursor: pointer;
    		float: left;
		}

		.button:hover {
   			background-color: #3e8e41;
		}
    </style>
  
</head>

<body>
    <form autocomplete="off">
    <!--禁用自动填充-->
    
	<div class="content"> 
		<h3 style="font-family: 微软雅黑">Damage Calculator</h3>
   		<hr noshade="noshade"/>

   		<div class="leftbox" >
    		<label id="lbl_ATKTYPE">1.选择攻击类型：</label>
        	<select id="CMB_atktype" onchange="CMB_atktype_changed()">
        	</select>
        	<br/><hr/>
        	<label id="2">2.计算基础攻击力：</label>
        	<br/>
        	<div class="BATK">
        		<label id="lbl_BATK_V1" class="small_label">V1:</label>
            	<input id="TBox_BATK_V1" type="text" class="BATK_input" onchange="check_set_BATK_Vn(1)" onkeypress="checkisnum()"/>
        	</div>
        	<div class="BATK">
        		<label id="lbl_BATK_V2" class="small_label">V2:</label>
            	<input id="TBox_BATK_V2" type="text" class="BATK_input" onchange="check_set_BATK_Vn(2)" onkeypress="checkisnum()"/>
        	</div>
        	<div class="BATK">
        		<label id="lbl_BATK_V3" class="small_label">V3:</label>
            	<input id="TBox_BATK_V3" type="text" class="BATK_input" onchange="check_set_BATK_Vn(3)" onkeypress="checkisnum()"/>
        	</div>
        	<div class="BATK">
        		<label id="lbl_BATK_V4" class="small_label">V4:</label>
            	<input id="TBox_BATK_V4" type="text" class="BATK_input" onchange="check_set_BATK_Vn(4)" onkeypress="checkisnum()"/>
        	</div>
        	<div class="BATK">
        		<label id="lbl_BATK_V5" class="small_label">V5:</label>
            	<input id="TBox_BATK_V5" type="text" class="BATK_input" onchange="check_set_BATK_Vn(5)" onkeypress="checkisnum2()"/>
        	</div>
            <div class="cal_batk">
            	<label>计算公式：</label><label id="lbl_formula">aa</label>
                <br/>
                <label>计算结果：</label><label id="lbl_BATK_result">00</label>
            </div>
            <hr/>
            <label>3.计算乘积系数：</label><br/>
            <label id="lbl_I_title">计算公式：</label><br/>
            <label id="lbl_I_formula" style="font-size:15px">xxx</label><br/>
            
            <div class="cal_I">
            	<div class="cal_I_cover" id="Gpb_I_cover_0" style="width:580px; height:60px">
           		</div>
            	<label class="small_label">阵形系数：</label><br/>
                <div class="cal_I_formation_direction_div">
               		<label class="small_label">单纵阵：</label>
                    <input id="TBox_I_formation_1" readonly="readonly" type="text" class="cal_I_formation_direction_input"  />
                </div>
                <div class="cal_I_formation_direction_div">
               		<label class="small_label">复纵阵：</label>
                    <input id="TBox_I_formation_2" readonly="readonly" type="text" class="cal_I_formation_direction_input"  />
                </div>
                <div class="cal_I_formation_direction_div">
               		<label class="small_label">轮形阵：</label>
                    <input id="TBox_I_formation_3" readonly="readonly" type="text" class="cal_I_formation_direction_input"  />
                </div>
                <div class="cal_I_formation_direction_div">
               		<label class="small_label">梯形阵：</label>
                    <input id="TBox_I_formation_4" readonly="readonly" type="text" class="cal_I_formation_direction_input"  />
                </div>
                <div class="cal_I_formation_direction_div">
               		<label class="small_label">单横阵：</label>
                    <input id="TBox_I_formation_5" readonly="readonly" type="text" class="cal_I_formation_direction_input"  />
                </div>
            </div>
            
     	 	<div class="cal_I">
            	<div class="cal_I_cover" id="Gpb_I_cover_1" style="width:580px; height:60px">
           		</div>
            	<label class="small_label">航向系数：</label><br/>
            	<div class="cal_I_formation_direction_div">
               		<label class="small_label">T有利：</label>
                    <input id="TBox_I_direction_1" readonly="readonly" type="text" class="cal_I_formation_direction_input"  />
                </div>
                <div class="cal_I_formation_direction_div">
               		<label class="small_label">同航战：</label>
                    <input id="TBox_I_direction_2" readonly="readonly" type="text" class="cal_I_formation_direction_input"  />
                </div>
                <div class="cal_I_formation_direction_div">
               		<label class="small_label">反航战：</label>
                    <input id="TBox_I_direction_3" readonly="readonly" type="text" class="cal_I_formation_direction_input"  />
                </div>
                <div class="cal_I_formation_direction_div">
               		<label class="small_label">T不利：</label>
                    <input id="TBox_I_direction_4" readonly="readonly" type="text" class="cal_I_formation_direction_input"  />
                </div>   
            </div>
            
            <div class="cal_I">
            	<div class="cal_I_cover" id="Gpb_I_cover_2" style="width:580px; height:40px">
           		</div>
                <label class="small_label">制空系数：</label><br/>
            	<label for="Rdb_I_airdomain1"class="mini_label"><input type="radio" id="Rdb_I_airdomain1" name="Rdb_I_airdomain_group" style="vertical-align: top" onchange="Rdb_I_airdomainN_CheckedChanged(0)"/>制空权占据:1.10</label>
                <label for="Rdb_I_airdomain2"class="mini_label"><input type="radio" id="Rdb_I_airdomain2" name="Rdb_I_airdomain_group" style="vertical-align: top" onchange="Rdb_I_airdomainN_CheckedChanged(1)"/>制空权优势:1.05</label>
                <label for="Rdb_I_airdomain3"class="mini_label"><input type="radio" id="Rdb_I_airdomain3" name="Rdb_I_airdomain_group" style="vertical-align: top" onchange="Rdb_I_airdomainN_CheckedChanged(2)"/>势均力敌:1.0</label>
                <label for="Rdb_I_airdomain4"class="mini_label"><input type="radio" id="Rdb_I_airdomain4" name="Rdb_I_airdomain_group" style="vertical-align: top" onchange="Rdb_I_airdomainN_CheckedChanged(3)"/>制空权劣势:0.95</label>
                <label for="Rdb_I_airdomain5"class="mini_label"><input type="radio" id="Rdb_I_airdomain5" name="Rdb_I_airdomain_group" style="vertical-align: top" onchange="Rdb_I_airdomainN_CheckedChanged(4)"/>制空权丧失:0.90</label>
                <br/>
            </div>
            
            <div class="cal_I">
            	<div class="cal_I_cover" id="Gpb_I_cover_3" style="width:580px; height:44px">
           		</div>
            	<label class="small_label">声纳系数：</label><br/>
                <label class="small_label">填入声纳装备的反潜值：</label>
                <input id="TBox_I_sonar" type="text" style="width:137px" onkeypress="checkisnum()" />
                <label class="small_label">计算公式和结果：</label>
                <label id="lbl_I_sonar_result" class="small_label">None</label><br/>                          	
            </div>
                       
            <div class="cal_I">
           		<div class="cal_I_cover" id="Gpb_I_cover_4" style="width:580px; height:44px">
           		</div>
            	<label class="small_label">弹药系数：</label><br/>
                <label class="small_label">填入当前弹药百分数(0~120)：</label>
                <input id="TBox_I_ammo" type="text" style="width:106px" onkeypress="checkisnum()" />
                <label class="small_label">计算公式和结果：</label>
                <label id="lbl_I_ammo_result" class="small_label">None</label><br/>           	
            </div>
            
            <div class="cal_I" style="height:42px;width:262px;float:left" >
            	<div class="cal_I_cover" id="Gpb_I_cover_5" style="width:254px; height:44px;">
           		</div>
            	<label class="small_label">输入鱼雷机系数：</label><br/>
           		<label class="small_label">系数取值范围(0.5~1)：</label>
            	<input id="TBox_I_tb"  type="text" style="width:84px" onkeypress="checkisnum2()"/>
            </div>
            
            <div class="cal_I" style="height:42px;width:324px; float:left;margin-left:6px" >
            	<div class="cal_I_cover" id="Gpb_I_cover_6" style="width:322px; height:44px;">
           		</div>
            	<label class="small_label">舰损系数：</label><br/>
                <label for="Rdb_I_sufferdmg1"class="mini_label" style=" margin:10px;"><input type="radio" id="Rdb_I_sufferdmg1" name="Rdb_I_sufferdmg_group" style="vertical-align: top;" onchange="Rdb_I_sufferdmgN_CheckedChanged(0)"/>未中破:1.0</label>
                <label for="Rdb_I_sufferdmg2"class="mini_label" style=" margin:5px;"><input type="radio" id="Rdb_I_sufferdmg2" name="Rdb_I_sufferdmg_group" style="vertical-align: top" onchange="Rdb_I_sufferdmgN_CheckedChanged(1)"/>中破:0.6</label>
                <label for="Rdb_I_sufferdmg3"class="mini_label" style=" margin:5px;"><input type="radio" id="Rdb_I_sufferdmg3" name="Rdb_I_sufferdmg_group" style="vertical-align: top" onchange="Rdb_I_sufferdmgN_CheckedChanged(2)"/>大破/击沉:0.3</label>
            </div>
            
            <div class="cal_I" style="clear:left">
            	<div class="cal_I_cover" id="Gpb_I_cover_7" style="width:580px; height:44px">
           		</div>
            	<label class="small_label">技能攻击力系数：</label><br/>
                <label class="small_label">填入技能加成百分数(如15%则填入15),若无则填入0：</label>
                <input id="TBox_I_skill"  type="text" style="width:44px" onkeypress="checkisnum()"/>
                <label class="small_label" style=" font-size:16px;font:'Times New Roman', Times, serif">=></label>
                <label id="lbl_I_skill_result" class="small_label">0000</label>
                <br/>
            </div>
            
            <div class="cal_I">
            	<div class="cal_I_cover" id="Gpb_I_cover_8" style="width:580px; height:44px">
           		</div>
            	<label class="small_label">暴击系数：</label><br/>
                <label class="small_label">填入技能提供的额外暴击伤害的百分数,若无则填入0：</label>
                <input id="TBox_I_crit"  type="text" style="width:44px" onkeypress="checkisnum()"/>
                <label class="small_label" style=" font-size:16px;font:'Times New Roman', Times, serif">=></label>
                <label id="lbl_I_crit_result" class="small_label">0000</label>
                <br/>
            </div>
            
            <div class="cal_I">
            	<div class="cal_I_cover" id="Gpb_I_cover_9" style="width:580px; height:40px">
           		</div>
            	<label class="small_label">浮动系数：</label><br/>
                <label class="small_label" style="float:left">当前攻击类型下的浮动系数：</label>               
                <label id="lbl_I_float_result" class="small_label" style="display:block;width:240px; float:left">0000</label>
                <label for="ChkBox_usesuperhvyshell"class="mini_label" style=" margin:10px;"><input type="checkbox" id="ChkBox_usesuperhvyshell" name="ChkBox_usesuperhvyshell" style="vertical-align: top;"/>装备了超重弹</label>
                <br/>
            </div>
                   
    	</div>	
        
  		<div class="rightbox">
       		<label>4.输入其它参数：</label><br/>
            <div class="other_I">
        		<div>
       				<label class="small_label">(1)敌方装甲：</label><input id="TBox_armor"  type="text" style="width:44px" onkeypress="checkisnum()"/>
                	<label class="small_label">(2)敌方血量：</label><input id="TBox_enemyhp"  type="text" style="width:80px" onkeypress="checkisnum()" />
            	</div>
            	<div>
           			<label class="small_label">(3)输入技能伤害倍率百分数：</label><input id="TBox_skill"  type="text" style="width:44px" onkeypress="checkisnum()"/>
          	 		<label class="small_label" style=" font-size:16px;font:'Times New Roman', Times, serif">=></label>
            		<label id="lbl_skill_result" class="small_label">0000</label>
            	</div>
            	<div>
            		<label class="small_label" style="float:left; position:relative; top:2px">(4)额外的穿甲系数百分数，当前值：</label><label id="lbl_pene" class="small_label" style="float:left;display:block;width:40px;text-align:center;position:relative; top:2px">0.6</label>
            		<input id="TBox_pene"  type="text" style="width:44px" onkeypress="checkisnum()" />
            		<label class="small_label" style=" font-size:16px;font:'Times New Roman', Times, serif;">=></label>
            		<label id="lbl_pene_result" class="small_label"  >0000</label> 
    			</div>
            </div>
            <hr />
            	
    	</div>
        <div class="rightbox" >
        		<button type="button" class="button"  style="width:100%" onclick="btn_click()">开始计算</button>       
        </div>
        <div class="rightbox">
        	<textarea id="RTBox_result" style="width:100%;height:675px;" readonly="readonly"></textarea>
        </div>
	</div> 
    </form>
<script type="text/javascript">
	//
	var D_BATK = 0; //基础攻击力
	var D_BATK_V1 = 0;
	var D_BATK_V2 = 0;
	var D_BATK_V3 = 0;
	var D_BATK_V4 = 0;
	var D_BATK_V5 = 0; //炮击(航母系)系数α
	//各种系数
	var D_I_tmp = 1; //临时存放的系数,是除了阵形、航向和浮动系数以外的系数的乘积
	var D_I_formation = [0,0,0,0]; //阵形
	var D_I_direction = [0,0,0]; //航向
	var D_I_airdomain = 1; //制空
	var D_I_sonar = 1; //声纳
	var D_I_sonar_raw = 0; //声纳装备的反潜值
	var D_I_tb = 1; //鱼雷机系数
	var D_I_ammo = 1; //系数
	var D_I_ammo_raw = 120; //弹药百分数
	var D_I_sufferdmg = 1; //战损
	var D_I_float = 1; //浮动系数
	var D_I_crit = 1; //暴击系数
	const C_I_is_crit = 1.5; //默认暴击为1.5
	var D_I_crit_add = 0; //额外的暴击百分数
	var D_I_skill = 1; //技能加成系数
	var D_I_skill_add = 0; //技能加成系数的百分数
	var D_I_pene = 1; //穿甲系数
	var D_I_pene_add = 0; //额外的穿甲系数
	var D_I_usesuperheavyshell = [0.89, 1.18, 1.47]; //使用了超重弹后的浮动系数
	//
	var D_armor = 0; //装甲值
	var D_skill = 1; //技能伤害倍率
	var D_skill_add = 0; //额外的技能伤害倍率
    var D_enemyhp = 0; //敌舰hp
	//
	var Dict_atktype= ["航空战(轰炸机)", "航空战(鱼雷机)", "昼战反潜(轻母航战)", "昼战反潜(驱逐巡洋)", "昼战炮击(航母系)", "昼战炮击(其他)", "昼战雷击", "夜战雷击", "夜战巡洋舰炮雷合击", "夜战巡洋舰炮击", "夜战其他炮击"];  //攻击类型	  
    var Dict_I_sonar = [0.5, 1]; //声纳系数
    var Dict_I_sufferdmg = [1, 0.6, 0.3]; //舰损系数:非中破,中破,大破/击沉 
    var Dict_I_airdomain = [1.1, 1.05, 1, 0.95, 0.9]; //制空系数:空占,空优,势均力敌,空劣,空丧
    var Dict_I_formation = [ //阵形系数：分别是，炮击(非航母)，雷击，夜战和无影响
            [1.0, 0.8, 0.75, 1.0, 0.8],
            [1.0, 0.9, 0.8, 1.0, 0.8],
            [1.1, 0.9, 1.0, 1.0, 1.0],
            [1.0, 1.0, 1.0, 1.0, 1.0]
        ];
    var Dict_I_direction = [ //航向系数:第一组为通常情况，T有利,同航战,反航战,T不利；第二组为无影响的情况
            [1.15, 1.0, 0.8, 0.65],
            [1.0, 1.0, 1.0, 1.0]
        ];
	var Dict_name_direction = ["T有利", "同航战", "反航战", "T不利"];
	var Dict_name_condition = ["未暴击下限", "未暴击平均", "未暴击上限", "暴击下限", "暴击平均", "暴击上限", "未暴击", "暴击"];
	//
	var Dict_atktype_enable_BATK = [ //决定要启用哪些变量来计算基础攻击力
            [1, 1, 0, 0, 0], //航空战(轰炸机)
            [1, 1, 0, 0, 0], //航空战(鱼雷机)
            [1, 0, 0, 0, 0], //昼战反潜(轻母航战)
            [1, 1, 0, 0, 0], //昼战反潜(驱逐巡洋)
            [1, 1, 1, 1, 1], //昼战炮击(航母系)
            [1, 0, 0, 0, 0], //昼战炮击(其他)
            [1, 0, 0, 0, 0], //昼战雷击
            [1, 0, 0, 0, 0], //夜战雷击
            [1, 1, 0, 0, 0], //夜战巡洋舰炮雷合击
            [1, 0, 0, 0, 0], //夜战巡洋舰炮击
            [1, 0, 0, 0, 0]  //夜战其他炮击
        ];
     var Dict_atktype_label = [ //基础攻击力的标签说明
            ["放飞机数：", "该格轰炸：", "不可用", "不可用", "不可用"],
            ["放飞机数：", "该格鱼雷：", "不可用", "不可用", "不可用"],
            ["舰船对潜：", "不可用", "不可用", "不可用", "不可用"],
            ["舰船对潜：", "深弹对潜：", "不可用", "不可用", "不可用"],
            ["火力：", "轰炸：", "鱼雷：", "对方总对空值：", "系数α(0~1)："],
            ["火力：", "不可用", "不可用", "不可用", "不可用"],
            ["鱼雷：", "不可用", "不可用", "不可用", "不可用"],
            ["鱼雷：", "不可用", "不可用", "不可用", "不可用"],
            ["火力：", "鱼雷：", "不可用", "不可用", "不可用"],
            ["火力：", "不可用", "不可用", "不可用", "不可用"],
            ["火力：", "不可用", "不可用", "不可用", "不可用"]
		];
	//决定要启用哪些系数
    //       1  2  3  4  5  6  7  8  9  10
    var Dict_atktype_enable_I = [
            [0, 0, 1, 0, 1, 0, 1, 1, 1, 1], //航空战(轰炸机)
            [0, 0, 0, 0, 1, 1, 1, 1, 1, 1], //航空战(鱼雷机)
            [0, 0, 0, 1, 1, 0, 0, 1, 1, 1], //昼战反潜(轻母航战
            [0, 0, 0, 1, 1, 0, 1, 1, 1, 1], //昼战反潜(驱逐巡洋)
            [0, 0, 1, 0, 1, 0, 0, 1, 1, 1], //昼战炮击(航母系)
            [1, 1, 0, 0, 1, 0, 1, 1, 1, 1], //昼战炮击(其他)
            [1, 1, 0, 0, 1, 0, 1, 1, 1, 1], //昼战雷击
            [1, 0, 0, 0, 1, 0, 1, 1, 1, 1], //夜战雷击
            [1, 0, 0, 0, 1, 0, 1, 1, 1, 1], //夜战巡洋舰炮雷合击
            [1, 0, 0, 0, 1, 0, 1, 1, 1, 1], //夜战巡洋舰炮击
            [1, 0, 0, 0, 1, 0, 1, 1, 1, 1]  //夜战其他炮击
        ];
	 //系数的结果表,分别是:未暴击下限,未暴击平均,未暴击上限;暴击下限,暴击平均,暴击上限;横向为阵形,纵向为航向
     var Dict_I_result = [
            [ //未暴击下限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //未暴击平均
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //未暴击上限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击下限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击平均
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击上限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ]
        ];
	var Dict_I_result_tmp = [0, 0, 0, 0, 0, 0]; //存放临时系数,是浮动值的上下限和平均值与暴击系数的乘积
	var Dict_ATK_result = [  //实际攻击力
            [ //未暴击下限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //未暴击平均
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //未暴击上限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击下限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击平均
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击上限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ]
        ];
	var Dict_penedmg_result = [  //穿甲伤害
            [ //未暴击下限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //未暴击平均
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //未暴击上限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击下限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击平均
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击上限
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ]
        ];
	var Dict_I_pene = [ //不同攻击类型的穿甲系数表
            1.0, //航空战(轰炸机)
            2.0, //航空战(鱼雷机)
            2.0, //昼战反潜(轻母航战)
            2.0, //昼战反潜(驱逐巡洋)
            1.0, //昼战炮击(航母系) 
            0.6, //昼战炮击(其他)
            1.0, //昼战雷击
            1.0, //夜战雷击
            1.0, //夜战巡洋舰炮雷合击
            0.6, //夜战巡洋舰炮击
            0.6  //夜战其他炮击
        ];
    var Dict_Percent_cansunk = [ //击沉率结果表
            [ //未暴击
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ]
        ];
	var Dict_Percent_cansunk = [ //中破率结果表
            [ //未暴击
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ]
        ];
	var Dict_Percent_hvydmg = [ //大破率结果表
            [ //未暴击
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ],
            [ //暴击
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0],
                [0, 0, 0, 0, 0]
            ]
        ];
	var Dict_I_float;
	//页面加载时运行
	Load_floattable();
	for (var i=0;i<Dict_atktype.length;i++){ //加载攻击类型下拉框
		var getData = Dict_atktype[i];
		document.getElementById("CMB_atktype").options.add(new Option(getData,i));
	};
	CMB_atktype_changed();
	
	
	
	//
	function  Load_floattable(){ //加载浮动系数表
        Dict_I_float = [ //浮动系数表
		   //下限,  平均,  上限
            [0.89, 1.055, 1.22],
            [0.89, 1.055, 1.22],
            [0.89, 1.055, 1.22],
            [0.89, 1.055, 1.22],
            [0.89, 1.055, 1.22],
            [0.89, 1.055, 1.22],
            [0.89, 1.055, 1.22],
            [2.4, 2.7, 3.0],
            [1.2, 1.5, 1.8],
            [2.4, 3.0, 3.6],
            [1.2, 1.5, 1.8]
        ];
	}
	//
	
	function CMB_atktype_changed(){ //下拉列表选择项改变后
		var index=document.getElementById("CMB_atktype").selectedIndex;
		select_val_to_cal_BATK(index); //根据攻击类型来设置要输入的变量V1~V5
		show_BATK_formula_and_calculate(index);//显示基础攻击力计算公式并计算
		show_I_formula(index);//显示系数计算公式
		show_I_float(index);//显示浮动系数
		show_I_pene(index);//显示穿甲系数
		select_I_val(index);//根据攻击类型来设置要使用的系数，并初始化系数的值
		
	};
	function check_set_BATK_Vn(index){ //处理文本框输入
		var tboxid = "TBox_BATK_V" + index;
		if ( document.getElementById(tboxid).value != "" ) {
			switch (index)
			{ 
				case 1:
					D_BATK_V1 = document.getElementById(tboxid).value;
					break;
				case 2:
					D_BATK_V2 = document.getElementById(tboxid).value;
					break;
				case 3:
					D_BATK_V3 = document.getElementById(tboxid).value;
					break;
				case 4:
					D_BATK_V4 = document.getElementById(tboxid).value;
					break;
				case 5:
					var num = Number(document.getElementById("TBox_BATK_V5").value); //限制系数α的范围为0~1
					if (num > 1) {
						document.getElementById("TBox_BATK_V5").value = "1";
					}
					if (num < 0) {
						document.getElementById("TBox_BATK_V5").value = "0";
					}
					D_BATK_V5 = document.getElementById(tboxid).value;
					break;
			}
		}
		show_BATK_formula_and_calculate(document.getElementById("CMB_atktype").selectedIndex); //计算基础攻击力
	};
	function checkisnum() { //检查是否为数字,只允许输入数字
		if (event.keyCode < 47 || event.keyCode > 57) {
			event.returnValue = false;
		}   
	};
	function checkisnum2() { //只允许输入数字和小数点
		if (event.keyCode < 46 || event.keyCode > 57) {
			event.returnValue = false;
		}
	};
	
	//
	function select_val_to_cal_BATK(CMB_atktype_i){	//根据攻击类型来设置要输入的变量
		for (var i =0;i<Dict_atktype_enable_BATK[1].length;i++){
			var id = i + 1;
			var tboxid = "TBox_BATK_V" + id;
			var labelid = "lbl_BATK_V" + id;
			if (Dict_atktype_enable_BATK[CMB_atktype_i][i] == 0) {
				document.getElementById(tboxid).disabled=true; //禁用用不到的input
			}
			else if (Dict_atktype_enable_BATK[CMB_atktype_i][i] == 1) {
				document.getElementById(tboxid).disabled=false; //启用相关的input
			}
			//设置label的文字
			document.getElementById(labelid).innerText = Dict_atktype_label[CMB_atktype_i][i];
		}
		clear_val_BATK();//每更换一次攻击类型,就清空变量的值
	//	alert(CMB_atktype_i);
	};
	function clear_val_BATK(){ //清空变量的值
		document.getElementById("lbl_BATK_result").innerText = "";
        D_BATK = 0;
        D_BATK_V1 = 0;
        D_BATK_V2 = 0;
        D_BATK_V3 = 0;
        D_BATK_V4 = 0;
        D_BATK_V5 = 0;
		document.getElementById("TBox_BATK_V1").value = "0";
		document.getElementById("TBox_BATK_V2").value = "0";
		document.getElementById("TBox_BATK_V3").value = "0";
		document.getElementById("TBox_BATK_V4").value = "0";
		document.getElementById("TBox_BATK_V5").value = "0";
	};
	function show_BATK_formula_and_calculate(CMB_atktype_i){ //计算公式可视化
		document.getElementById("lbl_formula").innerText = "";
		switch (CMB_atktype_i)
		{
			case 0: //航空战(轰炸机):LN(剩余机数 + 1) * 2 * 该格轰炸 + 25
				document.getElementById("lbl_formula").innerText = "ln( " + D_BATK_V1 + " + 1 ) × 2 × " + D_BATK_V2 + " + 25";
				BATK_Cal(0);
				break;
			case 1: //航空战(鱼雷机):LN(剩余机数 + 1) * 2 * 该格鱼雷 + 25
				document.getElementById("lbl_formula").innerText = "ln( " + D_BATK_V1 + " + 1 ) × 2 × " + D_BATK_V2 + " + 25";
				BATK_Cal(1);
				break;
			case 2: //反潜(轻母航战):	舰船对潜 / 3 + 30
				document.getElementById("lbl_formula").innerText = D_BATK_V1 + " ÷ 3";
				BATK_Cal(2);
				break;
			case 3: //反潜(驱逐巡洋):舰船对潜 / 3 + 深弹对潜 * 1.3 + 30 (有深弹); 舰船对潜 / 3 (无深弹)
				if (parseInt(document.getElementById("TBox_BATK_V2").value)==0){ //自动区分有无深弹
					document.getElementById("lbl_formula").innerText = D_BATK_V1 + " ÷ 3";
					BATK_Cal(30);
				}
				else {
					document.getElementById("lbl_formula").innerText =  D_BATK_V1 + " ÷ 3 + " + D_BATK_V2 + " × 1.3 + 30";
					BATK_Cal(31);
				}
				break;
			case 4: //炮击(航母系):(火力 + 轰炸 * 2 + 鱼雷) * MAX(0, 1 - 对方总对空值 * α / 150) + 35
				document.getElementById("lbl_formula").innerText =  "( " + D_BATK_V1 + " + " + D_BATK_V2 + " × 2 + " + D_BATK_V3 + " ) × MAX( 0 , 1 - " + D_BATK_V4 + " × " + D_BATK_V5 + " ÷ 150 ) + 35";
				BATK_Cal(4);
				break;
			case 5: //炮击(其他):火力 + 5
				document.getElementById("lbl_formula").innerText = D_BATK_V1 + " + 5";
				BATK_Cal(5);
				break;
			case 6: //雷击:鱼雷 + 5
				document.getElementById("lbl_formula").innerText = D_BATK_V1 + " + 5";
				BATK_Cal(6);
				break;
			case 7: //夜战雷击:鱼雷 + 10
				document.getElementById("lbl_formula").innerText = D_BATK_V1 + " + 10";
				BATK_Cal(7);
				break;
			case 8: //夜战巡洋舰炮雷合击:火力 + 鱼雷 + 10
				document.getElementById("lbl_formula").innerText = D_BATK_V1 + " + " + D_BATK_V2 + " + 10";
				BATK_Cal(8);
				break;
			case 9: //夜战巡洋舰炮击:火力 + 10
				document.getElementById("lbl_formula").innerText = D_BATK_V1 + " + 10";
				BATK_Cal(9);
				break;
			case 10: //夜战其他炮击:火力 + 10
				document.getElementById("lbl_formula").innerText = D_BATK_V1 + " + 10";
				BATK_Cal(10);
				break;
		}
	};
	function BATK_Cal(CMB_atktype_i){ //计算基础攻击力
		document.getElementById("lbl_BATK_result").innerText = "";
		switch (CMB_atktype_i)
		{
			case 0: //航空战(轰炸机)
				D_BATK = Math.log(Number(D_BATK_V1) + 1) * 2 * Number(D_BATK_V2) + 25;
				break;
			case 1: //航空战(鱼雷机)
				D_BATK = Math.log(Number(D_BATK_V1) + 1) * 2 * Number(D_BATK_V2) + 25;
				break;
			case 2: //反潜(轻母航战)
				D_BATK = Number(D_BATK_V1) / 3;
				break;
			case 30: //反潜(驱逐巡洋)无深弹
				D_BATK = Number(D_BATK_V1) / 3;
				break;
			case 31: //反潜(驱逐巡洋)有深弹
				D_BATK = Number(D_BATK_V1) / 3 + Number(D_BATK_V2) * 1.3 + 30;
				break;
			case 4: //炮击(航母系)
				D_BATK = (Number(D_BATK_V1) + Number(D_BATK_V2) * 2 + Number(D_BATK_V3)) * Math.max(0, (1 - Number(D_BATK_V4) * Number(D_BATK_V5) / 150)) + 35
				break;
			case 5: //炮击(其他)
				D_BATK = Number(D_BATK_V1) + 5;
				break;
			case 6: //雷击
				D_BATK = Number(D_BATK_V1) + 5;
				break;
			case 7: //夜战雷击
				D_BATK = Number(D_BATK_V1) + 10;
				break;
			case 8: //夜战巡洋舰炮雷合击
				D_BATK = Number(D_BATK_V1) + Number(D_BATK_V2) + 10;
				break;
			case 9: //夜战巡洋舰炮击
				D_BATK = Number(D_BATK_V1) + 10;
				break;
			case 10: //夜战其他炮击
				D_BATK = Number(D_BATK_V1) + 10;
				break;
		}
		document.getElementById("lbl_BATK_result").innerText = D_BATK;
	};
	function show_I_formula(CMB_atktype_i){ //显示系数计算公式,并计算部分系数
		document.getElementById("lbl_I_formula").innerText = "";
		switch (CMB_atktype_i)
		{
			case 0: //航空战(轰炸机)
                document.getElementById("lbl_I_formula").innerText = "制空系数 × 弹药系数 × 舰损系数 × 浮动系数 × 暴击系数 × 技能攻击力系数";
                D_I_tmp = Number(D_I_airdomain) * Number(D_I_ammo) * Number(D_I_sufferdmg) * Number(D_I_skill);
				break;
            case 1: //航空战(鱼雷机)
                document.getElementById("lbl_I_formula").innerText = "鱼雷机系数 × 弹药系数 × 舰损系数 × 浮动系数 × 暴击系数 × 技能攻击力系数";
                D_I_tmp = Number(D_I_tb) * Number(D_I_ammo) * Number(D_I_sufferdmg) * Number(D_I_skill);
				break;
            case 2: //反潜(轻母航战)
                document.getElementById("lbl_I_formula").innerText = "声呐系数 × 弹药系数 × 浮动系数 × 暴击系数 × 技能攻击力系数";
                I_sonar_cal(0);
                document.getElementById("lbl_I_sonar_result").innerText =  "1 + 声呐反潜值 ÷ 15 = " + D_I_sonar;
                D_I_tmp = Number(D_I_sonar) * Number(D_I_ammo) * Number(D_I_skill);
				break;
            case 3: //反潜(驱逐巡洋)
                document.getElementById("lbl_I_formula").innerText = "声呐系数 × 弹药系数 × 舰损系数 × 浮动系数 × 暴击系数 × 技能攻击力系数";
                I_sonar_cal(1);
                document.getElementById("lbl_I_sonar_result").innerText = "1 + 声呐反潜值 ÷ 10 = " + D_I_sonar;
                D_I_tmp = Number(D_I_sonar) * Number(D_I_ammo) * Number(D_I_sufferdmg) * Number(D_I_skill);
				break;
            case 4: //炮击(航母系)
                document.getElementById("lbl_I_formula").innerText = "制空系数 × 弹药系数 × 浮动系数 × 暴击系数 × 技能攻击力系数";
                D_I_tmp = Number(D_I_airdomain) * Number(D_I_ammo) * Number(D_I_skill);
				break;
            case 5: //炮击(其他)
                document.getElementById("lbl_I_formula").innerText = "阵型系数 × 航向系数 × 弹药系数 × 舰损系数 × 浮动系数 × 暴击系数 × 技能攻击力系数";
                D_I_tmp = Number(D_I_ammo) * Number(D_I_sufferdmg) * Number(D_I_skill);
				break;
            case 6: //雷击
                document.getElementById("lbl_I_formula").innerText = "阵型系数 × 航向系数 × 弹药系数 × 舰损系数 × 浮动系数 × 暴击系数 × 技能攻击力系数";
                D_I_tmp = Number(D_I_ammo) * Number(D_I_sufferdmg) * Number(D_I_skill);
				break;
            case 7:
			case 8: 
			case 9:
			case 10: //7,8,9,10,夜战
                document.getElementById("lbl_I_formula").innerText = "阵型系数 × 弹药系数 × 舰损系数 × 浮动系数 × 暴击系数 × 技能攻击力系数";
                D_I_tmp = Number(D_I_ammo) * Number(D_I_sufferdmg) * Number(D_I_skill);
				break;
		}
	};
	function I_sonar_cal(TYPE) { //声纳系数的计算
		switch (TYPE)
		{
			case 0: //反潜(轻母航战)的声纳系数的计算
				D_I_sonar = 1 + Number(D_I_sonar_raw) / 15;
				break;
			case 1: //反潜(驱逐巡洋)的声纳系数的计算
				D_I_sonar = 1 + Number(D_I_sonar_raw) / 10;
				break;
		}
	};
	function show_I_float(CMB_atktype_i) { //显示浮动系数
		document.getElementById("lbl_I_float_result").innerText = Dict_I_float[CMB_atktype_i][0] + " ~ " + Dict_I_float[CMB_atktype_i][2] + " ,  平均值为: " +   Dict_I_float[CMB_atktype_i][1];
	};
	function show_I_pene(CMB_atktype_i) { //显示基础穿甲系数
		document.getElementById("lbl_pene").innerText = Dict_I_pene[CMB_atktype_i];
		pene_cal(CMB_atktype_i);
	};
	function I_ammo_cal(){ //计算弹药系数
	
	};
	function I_crit_cal(){ //计算暴击伤害系数
	
	};
	function I_skill_cal() { //计算技能攻击力系数
		
	};
	function skill_cal() { //计算技能伤害倍率
		
	};
	
	function pene_cal(CMB_atktype_i) { //计算穿甲系数
		D_I_pene = Dict_I_pene[CMB_atktype_i] + Number(D_I_pene_add) / 100;
		document.getElementById("lbl_pene_result").innerText = D_I_pene;
	};
	
	function select_I_val(CMB_atktype_i) { //根据攻击类型来设置要使用的系数，并初始化系数的值
		for (var i=0;i<Dict_atktype_enable_I[1].length;i++){
			var divboxid = "Gpb_I_cover_" + i;
			if (Dict_atktype_enable_I[CMB_atktype_i][i] == 0) {
				document.getElementById(divboxid).style.display="block"; //禁用用不到系数输入位置
			}
			else if (Dict_atktype_enable_I[CMB_atktype_i][i] == 1) {
				document.getElementById(divboxid).style.display="none"; //启用
			}
		};
		//
		document.getElementById("Rdb_I_airdomain1").checked=false;
		document.getElementById("Rdb_I_airdomain2").checked=false;
		document.getElementById("Rdb_I_airdomain3").checked=false;
		document.getElementById("Rdb_I_airdomain4").checked=false;
		document.getElementById("Rdb_I_airdomain5").checked=false;
		document.getElementById("Rdb_I_sufferdmg1").checked=false;
		document.getElementById("Rdb_I_sufferdmg2").checked=false;
		document.getElementById("Rdb_I_sufferdmg3").checked=false;
		document.getElementById("ChkBox_usesuperhvyshell").checked=false;
		document.getElementById("ChkBox_usesuperhvyshell").disabled=true;
		document.getElementById("TBox_I_sonar").value = "0";
		document.getElementById("TBox_I_ammo").value = "100";
		document.getElementById("TBox_I_skill").value = "0";
		document.getElementById("TBox_I_crit").value = "0";
		document.getElementById("TBox_pene").value = "0";
		document.getElementById("TBox_I_tb").value = "0";
		//
		switch (CMB_atktype_i)
		{
			case 0: //航空战(轰炸机)
				document.getElementById("Rdb_I_airdomain1").click(); //制空系数
				document.getElementById("Rdb_I_sufferdmg1").click(); //舰损系数
				I_select_formation(3); //阵形无影响
				I_select_direction(1); //航向无影响
				break;
			case 1: //航空战(鱼雷机)
				document.getElementById("Rdb_I_sufferdmg1").click(); //舰损系数
				I_select_formation(3); //阵形无影响
				I_select_direction(1); //航向无影响
				break;	
			case 2: //反潜(轻母航战)
				I_select_formation(3); //阵形无影响
				I_select_direction(1); //航向无影响
				break;
			case 3: //反潜(驱逐巡洋)
				document.getElementById("Rdb_I_sufferdmg1").click(); //舰损系数
				I_select_formation(3); //阵形无影响
				I_select_direction(1); //航向无影响
				break;
			case 4: //炮击(航母系)
				document.getElementById("Rdb_I_airdomain1").click(); //制空系数
				I_select_formation(3); //阵形无影响
				I_select_direction(1); //航向无影响
				break;
			case 5: //炮击(其他)
				document.getElementById("Rdb_I_sufferdmg1").click(); //舰损系数
				I_select_formation(0); //阵形
				I_select_direction(0); //航向
				document.getElementById("ChkBox_usesuperhvyshell").disabled=false; //只有昼战炮击才用得到超重弹
				break;
			case 6: //雷击
				document.getElementById("Rdb_I_sufferdmg1").click(); //舰损系数
				I_select_formation(1); //阵形
				I_select_direction(0); //航向
				break;
			case 7: //夜战
			case 8:
			case 9:
			case 10:
				document.getElementById("Rdb_I_sufferdmg1").click(); //舰损系数
				I_select_formation(2); //阵形
				I_select_direction(1); //航向无影响
				break;
		};	
	};
	function I_select_formation(TYPE) { //设置阵形系数的显示
		for (var i=0;i<Dict_I_formation[1].length;i++) { //传入参数TYPE：0为炮击(非航母),1为雷击,2为夜战和3为无影响,并赋值
			var id = i + 1;
			var boxid = "TBox_I_formation_" + id;
			document.getElementById(boxid).value = Dict_I_formation[TYPE][i];
		}
	};
	function I_select_direction(TYPE) { //设置航向系数的显示
		for (var i=0;i<Dict_I_direction[1].length;i++) { //传入参数TYPE：0为正常情况，1为航向无影响的情况,并赋值
			var id = i + 1;
			var boxid = "TBox_I_direction_" + id;
			document.getElementById(boxid).value = Dict_I_direction[TYPE][i];
		}
	};
	function Rdb_I_airdomainN_CheckedChanged(index){ //根据所选radio来设置制空系数变量
		D_I_airdomain = Dict_I_airdomain[index];
	};
	function Rdb_I_sufferdmgN_CheckedChanged(index){ //根据所选radio来设置舰损系数
		D_I_sufferdmg = Dict_I_sufferdmg[index];
	};
	//
	function btn_click() {
		alert ("制空系数：" + D_I_airdomain + " 置舰损系数: " + D_I_sufferdmg)
	};
	

</script>
</body>
</html>
